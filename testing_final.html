<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Spin The Wheel</title>
    <link rel="icon" href="logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            }
        }
    </script>
    
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        html, body {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            overscroll-behavior: none;
        }

        body {
            touch-action: pan-y;
        }

        .wheel {
            transition-property: transform;
            transition-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
            transform-origin: center center;
            will-change: transform;
        }

        .wheel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
            user-select: none;
            -webkit-user-drag: none;
        }
        .pointer-image {
    width: 80px;
    height: 80px;
    object-fit: contain;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
    pointer-events: none;
    user-select: none;
}
@media (min-width: 640px) {
    .pointer-image {
        width: 100px;
        height: 100px;
    }
}
#pointerWrapper {
    top: -40px; /* for 80px pointer */
}

@media (min-width: 640px) {
    #pointerWrapper {
        top: -50px; /* for 100px pointer */
    }
}


        .spin-button {
            transition: all 0.2s ease;
            touch-action: manipulation;
        }

        .spin-button:active:not(:disabled) {
            transform: translate(-50%, -50%) scale(0.9);
        }

        .modal-backdrop {
            backdrop-filter: blur(8px);
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }

        .no-scroll {
            position: fixed;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }

        .settings-content {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            overflow: hidden;
        }

        .settings-content.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .settings-content.expanded {
            max-height: 500px;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 text-gray-900 dark:text-gray-100 font-sans antialiased">

    <div class="flex flex-col h-full w-full safe-area-inset">
        <!-- Header -->
        <header class="flex-shrink-0 pt-4 pb-2 px-4">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-center bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent">
                SPIN THE WHEEL
            </h1>
        </header>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col items-center justify-center px-4 min-h-0 overflow-y-auto">
            <div class="w-full max-w-md flex flex-col items-center justify-center">
                <!-- Wheel Container -->
                <div id="wheel-container" class="relative mb-6 flex-shrink-0">
                    <!-- Pointer -->
                    <!-- <div class="absolute -top-6 sm:-top-8 left-1/2 -translate-x-1/2 z-20"> -->
                        <div id="pointerWrapper"
     class="absolute left-1/2 -translate-x-1/2 z-20">

                        <img src="pointer.png" alt="Pointer" class="pointer-image" id="pointerImage" draggable="false">
                    </div>

                    <!-- Wheel -->
                    <div id="wheel" class="wheel w-full h-full rounded-full shadow-2xl relative overflow-hidden">
                        <img src="wheel.jpg" alt="Spinning Wheel" class="wheel-image" draggable="false">
                    </div>

                    <!-- Spin Button -->
                    <button id="spinButton" 
                            class="spin-button absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-20 sm:w-24 sm:h-24 bg-white dark:bg-gray-800 rounded-full border-4 border-gray-300 dark:border-gray-600 shadow-xl z-10 font-bold text-base sm:text-lg text-blue-600 dark:text-blue-400 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-4 focus:ring-blue-500/50">
                        SPIN
                    </button>
                </div>

                <!-- Settings Section -->
                <div class="w-full bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm p-4 sm:p-5 rounded-2xl shadow-lg">
                    <button id="settingsToggle" 
                            class="w-full flex justify-between items-center text-base sm:text-lg font-semibold text-gray-800 dark:text-gray-200 focus:outline-none">
                        <span>Settings</span>
                        <svg id="settingsIcon" 
                             class="h-5 w-5 transition-transform duration-300" 
                             fill="none" 
                             viewBox="0 0 24 24" 
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>

                    <div id="settingsContent" class="settings-content collapsed">
                        <div class="pt-4 space-y-4">
                            <!-- Wheel Size -->
                            <div>
                                <label for="wheelSizeSlider" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Wheel Size: <span id="wheelSizeValue" class="font-bold text-blue-600 dark:text-blue-400">280px</span>
                                </label>
                                <input type="range" 
                                       id="wheelSizeSlider" 
                                       min="220" 
                                       max="400" 
                                       value="280" 
                                       class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600">
                            </div>

                            <!-- Spin Duration -->
                            <div>
                                <label for="spinDurationSlider" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Spin Duration: <span id="spinDurationValue" class="font-bold text-blue-600 dark:text-blue-400">5s</span>
                                </label>
                                <input type="range" 
                                       id="spinDurationSlider" 
                                       min="3" 
                                       max="10" 
                                       value="5" 
                                       class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-600">
                            </div>

                            <!-- Theme Toggle -->
                            <div class="flex items-center justify-between pt-2 border-t border-gray-200 dark:border-gray-700">
                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">
                                    Dark Mode
                                </label>
                                <button id="themeToggle" 
                                        class="relative inline-flex h-8 w-14 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 bg-gray-300 dark:bg-blue-600"
                                        role="switch"
                                        aria-checked="true">
                                    <span id="themeToggleCircle" 
                                          class="inline-block h-6 w-6 transform rounded-full bg-white transition-transform translate-x-7 dark:translate-x-1">
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="flex-shrink-0 text-center py-3 px-4">
            <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">
                Created by 
                <a href="https://mithunrajmr.netlify.app/" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="font-semibold text-blue-600 dark:text-blue-400 hover:underline">
                    Mithun Raj
                </a>
            </p>
        </footer>
    </div>

    <!-- Winner Modal -->
    <div id="modal" 
         class="fixed inset-0 bg-black/80 modal-backdrop flex items-center justify-center z-50 p-4 hidden" 
         role="dialog" 
         aria-modal="true" 
         aria-labelledby="modal-title">
        <canvas id="confettiCanvas" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>
        
        <div id="modalContent" 
             class="relative bg-white dark:bg-gray-800 w-full max-w-sm p-6 sm:p-8 rounded-3xl shadow-2xl text-center opacity-0">
            <div class="mb-4">
                <div class="text-5xl mb-2">ðŸŽ‰</div>
                <h2 id="modal-title" class="text-lg sm:text-xl font-medium text-gray-500 dark:text-gray-400 mb-3">
                    Congratulations!
                </h2>
                <p id="winnerText" 
                   class="text-2xl sm:text-3xl md:text-4xl font-bold text-blue-600 dark:text-blue-400 mb-6 break-words">
                    You won!
                </p>
            </div>
            <button id="closeModal" 
                    class="w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-blue-500/50">
                Spin Again
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elements
            const wheel = document.getElementById('wheel');
            const spinButton = document.getElementById('spinButton');
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modalContent');
            const closeModal = document.getElementById('closeModal');
            const winnerText = document.getElementById('winnerText');
            const wheelContainer = document.getElementById('wheel-container');
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsIcon = document.getElementById('settingsIcon');
            const settingsContent = document.getElementById('settingsContent');
            const wheelSizeSlider = document.getElementById('wheelSizeSlider');
            const wheelSizeValue = document.getElementById('wheelSizeValue');
            const spinDurationSlider = document.getElementById('spinDurationSlider');
            const spinDurationValue = document.getElementById('spinDurationValue');
            const themeToggle = document.getElementById('themeToggle');
            const themeToggleCircle = document.getElementById('themeToggleCircle');
            const htmlEl = document.documentElement;

            // Wheel segments (clockwise from top)
            const wheelSegments = [
                'Complimentary Drink',
                'Better Luck Next Time',
                'Complimentary Drink',
                'Better Luck Next Time',
                'Complimentary Drink'
            ];

            // State
            let currentRotation = 0;
            let isSpinning = false;
            let wheelSize = 280;
            let spinDuration = 5000;
            const WHEEL_OFFSET = 38;

            // Initialize wheel size based on viewport
            function getOptimalWheelSize() {
                const vw = window.innerWidth;
                const vh = window.innerHeight;
                const isMobile = vw < 640;
                
                const padding = isMobile ? 32 : 64;
                const headerHeight = isMobile ? 80 : 100;
                const footerHeight = 60;
                const settingsHeight = 100;
                const spacing = isMobile ? 80 : 100;
                
                const availableWidth = vw - padding;
                const availableHeight = vh - headerHeight - footerHeight - settingsHeight - spacing;
                
                const maxSize = isMobile ? 320 : 400;
                const minSize = 220;
                
                let size = Math.min(availableWidth, availableHeight, maxSize);
                size = Math.max(size, minSize);
                
                return Math.floor(size);
            }

            function updateWheelDimensions() {
                wheelContainer.style.width = `${wheelSize}px`;
                wheelContainer.style.height = `${wheelSize}px`;
            }

            function updateSpinDuration() {
                wheel.style.transitionDuration = `${spinDuration}ms`;
            }

            function calculateWinner(rotation) {
                const correctedRotation = (rotation + WHEEL_OFFSET) % 360;
                const normalizedRotation = correctedRotation % 360;
                let pointerAngle = (360 - normalizedRotation) % 360;
                
                const offsetAngle = (pointerAngle + 36) % 360;
                let segmentIndex = Math.floor(offsetAngle / 72);
                segmentIndex = (segmentIndex + 1) % 5;
                
                return wheelSegments[segmentIndex];
            }

            function initializeWheelSize() {
                wheelSize = getOptimalWheelSize();
                wheelSizeSlider.value = wheelSize;
                wheelSizeSlider.max = Math.min(400, wheelSize + 80);
                wheelSizeSlider.min = Math.max(220, wheelSize - 60);
                wheelSizeValue.textContent = `${wheelSize}px`;
                updateWheelDimensions();
            }

            // Settings toggle
            settingsToggle.addEventListener('click', () => {
                const isCollapsed = settingsContent.classList.contains('collapsed');
                
                if (isCollapsed) {
                    settingsContent.classList.remove('collapsed');
                    settingsContent.classList.add('expanded');
                    settingsIcon.style.transform = 'rotate(180deg)';
                } else {
                    settingsContent.classList.remove('expanded');
                    settingsContent.classList.add('collapsed');
                    settingsIcon.style.transform = 'rotate(0deg)';
                }
            });

            // Wheel size slider
            wheelSizeSlider.addEventListener('input', (e) => {
                wheelSize = parseInt(e.target.value);
                wheelSizeValue.textContent = `${wheelSize}px`;
                updateWheelDimensions();
            });

            // Spin duration slider
            spinDurationSlider.addEventListener('input', (e) => {
                spinDuration = parseInt(e.target.value) * 1000;
                spinDurationValue.textContent = `${e.target.value}s`;
                updateSpinDuration();
            });

            // Theme toggle
            themeToggle.addEventListener('click', () => {
                htmlEl.classList.toggle('dark');
                const isDark = htmlEl.classList.contains('dark');
                themeToggle.setAttribute('aria-checked', isDark);
            });

            // Spin button
            spinButton.addEventListener('click', () => {
                if (isSpinning) return;
                
                isSpinning = true;
                spinButton.disabled = true;

                const baseSpins = 5 + Math.floor(Math.random() * 3);
                const randomStopAngle = Math.random() * 360;
                const totalRotation = (baseSpins * 360) + randomStopAngle;
                
                currentRotation += totalRotation;
                wheel.style.transform = `rotate(${currentRotation}deg)`;
            });

            // Wheel transition end
            wheel.addEventListener('transitionend', () => {
                if (!isSpinning) return;
                
                isSpinning = false;
                spinButton.disabled = false;

                const winner = calculateWinner(currentRotation);
                showWinner(winner);
            });

            // Show winner modal
            function showWinner(winnerTextValue) {
                winnerText.className = 'font-bold text-blue-600 dark:text-blue-400 mb-6 break-words';
                
                if (winnerTextValue.length > 18) {
                    winnerText.classList.add('text-xl', 'sm:text-2xl');
                } else {
                    winnerText.classList.add('text-2xl', 'sm:text-3xl', 'md:text-4xl');
                }

                winnerText.textContent = winnerTextValue;
                modal.classList.remove('hidden');
                document.body.classList.add('no-scroll');
                
                setTimeout(() => {
                    modalContent.classList.add('animate-slide-up');
                    modalContent.style.opacity = '1';
                }, 10);

                startConfetti();
            }

            // Close modal
            function hideModal() {
                modalContent.style.opacity = '0';
                modalContent.classList.remove('animate-slide-up');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                    document.body.classList.remove('no-scroll');
                    stopConfetti();
                }, 200);
            }

            closeModal.addEventListener('click', hideModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) hideModal();
            });

            // Confetti
            const confettiCanvas = document.getElementById('confettiCanvas');
            const ctx = confettiCanvas.getContext('2d');
            let confettiParticles = [];
            let confettiAnimationId;
            const confettiColors = ['#3b82f6', '#8b5cf6', '#ec4899', '#10b981', '#f59e0b', '#ef4444'];

            function resizeCanvas() {
                confettiCanvas.width = window.innerWidth;
                confettiCanvas.height = window.innerHeight;
            }

            function Particle() {
                this.x = confettiCanvas.width / 2;
                this.y = confettiCanvas.height / 2;
                this.radius = Math.random() * 4 + 2;
                this.color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                this.vx = (Math.random() - 0.5) * 12;
                this.vy = (Math.random() - 0.5) * 12 - 5;
                this.opacity = 1;
                this.gravity = 0.15;
                this.friction = 0.98;
            }

            Particle.prototype.draw = function() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.opacity;
                ctx.fill();
                ctx.globalAlpha = 1;
            };

            Particle.prototype.update = function() {
                this.vy += this.gravity;
                this.vx *= this.friction;
                this.vy *= this.friction;
                this.x += this.vx;
                this.y += this.vy;
                this.opacity -= 0.004;
            };

            function startConfetti() {
                resizeCanvas();
                confettiParticles = [];
                for (let i = 0; i < 150; i++) {
                    confettiParticles.push(new Particle());
                }
                animateConfetti();
            }

            function animateConfetti() {
                ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
                confettiParticles = confettiParticles.filter(p => p.opacity > 0 && p.y < confettiCanvas.height);
                confettiParticles.forEach(p => {
                    p.update();
                    p.draw();
                });
                if (confettiParticles.length > 0) {
                    confettiAnimationId = requestAnimationFrame(animateConfetti);
                }
            }

            function stopConfetti() {
                cancelAnimationFrame(confettiAnimationId);
                confettiParticles = [];
                ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            }

            // Handle resize with debounce
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    initializeWheelSize();
                    resizeCanvas();
                }, 150);
            });

            // Prevent pull-to-refresh on mobile
            let startY;
            document.addEventListener('touchstart', e => {
                startY = e.touches[0].pageY;
            }, { passive: true });

            document.addEventListener('touchmove', e => {
                const y = e.touches[0].pageY;
                if (window.scrollY === 0 && y > startY) {
                    e.preventDefault();
                }
            }, { passive: false });

            // Initialize
            initializeWheelSize();
            updateSpinDuration();
            resizeCanvas();
        });
    </script>
</body>
</html>
